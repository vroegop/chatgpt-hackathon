<!DOCTYPE html>
<html>
<head>
    <title>ChatGPT Response</title>
</head>
<body>
<h1>ChatGPT Response:</h1>
<div id="responseContainer"></div>

<script type="module">
    const openai = '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';

    async function getChatGPTResponse(messages, {model, max_tokens, temperature} = {
        model: 'gpt-3.5-turbo',
        max_tokens: 200,
        temperature: 0.5
    }) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${openai}`
                },
                body: JSON.stringify({
                    model,
                    messages,
                    max_tokens,
                    temperature,
                    n: 1,
                })
            });

            if (!response.ok) {
                throw new Error('Not ok');
            }

            const data = await response.json();
            return data.choices[0].message;
        } catch (err) {
            console.error(err);
            return {role: 'system', content: 'Oh no, the chatbot was unavailable. Please try again.'}
        }
    }

    async function displayResponse() {
        const responseContainer = document.getElementById('responseContainer');
        const messages = [
                {"role": "system", "content": "Act like a DND dungeon master using 5e rules and after every prompt ask the user for input."},
                {"role": "system", "content": "Ask a user which characters will play and ask him for a character sheet of every character. Missing values can be made up. Show the character sheet after each creation and ask if there are others. If there are no more character sheets, ask the player to describe the world they play in. If you know what it looks like, begin the game."},
                {"role": "assistant", "content": "Greetings adventurer! Welcome to my realm. Please tell me the names of your characters and we will start with their character sheet after that."},
                {"role": "user", "content": "All luminis employees will play! DaniÃ«l, Lutske, Steef, Niels and Randy."}
            ];

        const response = await getChatGPTResponse(messages);

        [ ...messages, response ].filter(a => a.role !== 'system').forEach((responseItem) => {
            const { role, content } = responseItem;

            const heading = document.createElement('h1');
            heading.textContent = role;

            const paragraph = document.createElement('p');
            paragraph.textContent = content;

            responseContainer.appendChild(heading);
            responseContainer.appendChild(paragraph);
        });
    }

    displayResponse();
</script>
</body>
</html>
